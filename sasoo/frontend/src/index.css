@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --color-bg-primary: #0f172a;
  --color-bg-secondary: #1e293b;
  --color-bg-tertiary: #334155;
  --color-text-primary: #f1f5f9;
  --color-text-secondary: #e2e8f0;
  --color-text-muted: #94a3b8;
  --color-accent: #6366f1;
  --color-accent-hover: #818cf8;
  --color-border: #334155;
  --color-success: #10b981;
  --color-warning: #f59e0b;
  --color-error: #ef4444;
  --sidebar-width: 16rem;
  --sidebar-collapsed-width: 4rem;
  --header-height: 3rem;
  --transition-speed: 200ms;
}

.light {
  --color-bg-primary: #ffffff;
  --color-bg-secondary: #f8fafc;
  --color-bg-tertiary: #e2e8f0;
  --color-text-primary: #0f172a;
  --color-text-secondary: #1e293b;
  --color-text-muted: #64748b;
  --color-accent: #4f46e5;
  --color-accent-hover: #6366f1;
  --color-border: #cbd5e1;
  --color-success: #059669;
  --color-warning: #d97706;
  --color-error: #dc2626;
}

@layer base {
  html {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }

  body {
    @apply bg-surface-900 text-surface-200;
    transition: background-color var(--transition-speed), color var(--transition-speed);
  }

  .light body,
  .light {
    @apply bg-white text-surface-800;
  }

  /* Custom scrollbar for dark theme */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    @apply bg-transparent;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-surface-600 rounded-full;
    transition: background-color var(--transition-speed);
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-surface-500;
  }

  .light ::-webkit-scrollbar-thumb {
    @apply bg-surface-300;
  }

  .light ::-webkit-scrollbar-thumb:hover {
    @apply bg-surface-400;
  }

  /* Selection color */
  ::selection {
    @apply bg-primary-600/40 text-white;
  }

  /* Prevent text selection during resize */
  .resizing * {
    user-select: none !important;
    cursor: col-resize !important;
  }
}

@layer components {
  /* Reusable card component */
  .card {
    @apply bg-surface-800 border border-surface-700 rounded-xl p-4;
  }

  .light .card {
    @apply bg-white border-surface-200 shadow-sm;
  }

  .card-hover {
    @apply card transition-all duration-200 hover:border-primary-500/50 hover:shadow-lg hover:shadow-primary-500/5;
  }

  /* Button variants */
  .btn {
    @apply inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-surface-900 disabled:opacity-50 disabled:pointer-events-none;
  }

  .light .btn {
    @apply focus:ring-offset-white;
  }

  .btn-primary {
    @apply btn bg-primary-600 text-white hover:bg-primary-500 focus:ring-primary-500;
  }

  .btn-secondary {
    @apply btn bg-surface-700 text-surface-200 hover:bg-surface-600 focus:ring-surface-500;
  }

  .light .btn-secondary {
    @apply bg-surface-100 text-surface-700 hover:bg-surface-200;
  }

  .btn-ghost {
    @apply btn bg-transparent text-surface-300 hover:bg-surface-800 hover:text-surface-100 focus:ring-surface-500;
  }

  .light .btn-ghost {
    @apply text-surface-600 hover:bg-surface-100 hover:text-surface-800;
  }

  .btn-danger {
    @apply btn bg-red-600 text-white hover:bg-red-500 focus:ring-red-500;
  }

  /* Input styles */
  .input {
    @apply w-full rounded-lg border border-surface-600 bg-surface-800 px-3 py-2 text-sm text-surface-200 placeholder-surface-500 transition-colors focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500;
  }

  .light .input {
    @apply border-surface-300 bg-white text-surface-800 placeholder-surface-400;
  }

  /* Badge */
  .badge {
    @apply inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium;
  }

  .badge-primary {
    @apply badge bg-primary-500/10 text-primary-400;
  }

  .badge-success {
    @apply badge bg-emerald-500/10 text-emerald-400;
  }

  .badge-warning {
    @apply badge bg-amber-500/10 text-amber-400;
  }

  .badge-error {
    @apply badge bg-red-500/10 text-red-400;
  }

  /* Skeleton loader */
  .skeleton {
    @apply animate-pulse rounded bg-surface-700;
  }

  .light .skeleton {
    @apply bg-surface-200;
  }

  /* Phase status dots */
  .phase-dot {
    @apply w-3 h-3 rounded-full border-2;
  }

  .phase-dot-pending {
    @apply phase-dot border-surface-500 bg-transparent;
  }

  .phase-dot-running {
    @apply phase-dot border-primary-500 bg-primary-500 animate-pulse-subtle;
  }

  .phase-dot-done {
    @apply phase-dot border-emerald-500 bg-emerald-500;
  }

  .phase-dot-error {
    @apply phase-dot border-red-500 bg-red-500;
  }
}

/* Utilities (unlayered to avoid @apply circular dependency with custom colors) */
  /* Glass morphism effect */
  .glass {
    @apply bg-surface-800/80 backdrop-blur-md border border-surface-700/50;
  }

  .light .glass {
    @apply bg-white/80 border-surface-200/50;
  }

  /* Text gradient */
  .text-gradient {
    @apply bg-gradient-to-r from-primary-400 to-primary-600 bg-clip-text text-transparent;
  }

  /* Truncate multiline */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Split view resize handle */
  .resize-handle {
    width: 6px;
    @apply cursor-col-resize bg-surface-700 transition-all duration-200 relative flex-shrink-0;
  }

  /* Expanded hit area for easier grabbing */
  .resize-handle::before {
    content: '';
    @apply absolute inset-y-0 -left-2 -right-2 z-10;
  }

  /* Grip dots (3 vertical dots in center) */
  .resize-handle::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 2px;
    height: 20px;
    background-image: radial-gradient(circle, currentColor 1px, transparent 1px);
    background-size: 2px 7px;
    background-repeat: repeat-y;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .resize-handle:hover::after,
  .resize-handle:focus-visible::after,
  .resize-handle.active::after {
    opacity: 0.6;
  }

  /* Hover state: widen + color */
  .resize-handle:hover {
    width: 8px;
    @apply bg-primary-500/70;
    box-shadow: -2px 0 8px rgba(99, 102, 241, 0.1), 2px 0 8px rgba(99, 102, 241, 0.1);
  }

  /* Active/dragging state */
  .resize-handle.active {
    width: 8px;
    @apply bg-primary-500;
    box-shadow: -3px 0 12px rgba(99, 102, 241, 0.2), 3px 0 12px rgba(99, 102, 241, 0.2);
  }

  /* Snap indicator */
  .resize-handle.snapping {
    @apply bg-primary-400;
    box-shadow: -4px 0 16px rgba(99, 102, 241, 0.3), 4px 0 16px rgba(99, 102, 241, 0.3);
  }

  /* Focus visible for keyboard users */
  .resize-handle:focus-visible {
    width: 8px;
    @apply bg-primary-500 outline-none;
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5);
  }

  .light .resize-handle {
    @apply bg-surface-300;
  }

  .light .resize-handle:hover {
    @apply bg-primary-500/70;
    box-shadow: -2px 0 8px rgba(79, 70, 229, 0.1), 2px 0 8px rgba(79, 70, 229, 0.1);
  }

  .light .resize-handle.active {
    @apply bg-primary-500;
    box-shadow: -3px 0 12px rgba(79, 70, 229, 0.15), 3px 0 12px rgba(79, 70, 229, 0.15);
  }

  /* Fade in animation for progressive loading */
  .fade-in-up {
    animation: fadeInUp 0.4s ease-out forwards;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Markdown content in analysis panel */
  .analysis-content h1 {
    @apply text-xl font-bold text-surface-100 mb-3 mt-6 first:mt-0;
  }

  .analysis-content h2 {
    @apply text-lg font-semibold text-surface-100 mb-2 mt-5;
  }

  .analysis-content h3 {
    @apply text-base font-semibold text-surface-200 mb-2 mt-4;
  }

  .analysis-content p {
    @apply text-sm text-surface-300 leading-relaxed mb-3;
  }

  .analysis-content ul {
    @apply list-disc list-inside text-sm text-surface-300 mb-3 space-y-1;
  }

  .analysis-content ol {
    @apply list-decimal list-inside text-sm text-surface-300 mb-3 space-y-1;
  }

  .analysis-content blockquote {
    @apply border-l-2 border-primary-500 pl-3 italic text-surface-400 my-3;
  }

  .analysis-content code {
    @apply text-xs bg-surface-700 text-primary-300 rounded px-1.5 py-0.5;
  }

  .analysis-content pre {
    @apply bg-surface-800 border border-surface-700 rounded-lg p-3 overflow-x-auto my-3;
  }

  .analysis-content pre code {
    @apply bg-transparent p-0;
  }

  .analysis-content table {
    @apply w-full text-sm border-collapse my-3;
  }

  .analysis-content th {
    @apply text-left font-semibold text-surface-200 border-b border-surface-600 pb-2 pr-4;
  }

  .analysis-content td {
    @apply text-surface-300 border-b border-surface-700 py-2 pr-4;
  }

  .light .analysis-content h1,
  .light .analysis-content h2,
  .light .analysis-content h3 {
    @apply text-surface-900;
  }

  .light .analysis-content p,
  .light .analysis-content ul,
  .light .analysis-content ol {
    @apply text-surface-600;
  }

  .light .analysis-content code {
    @apply bg-surface-100 text-primary-700;
  }

  .light .analysis-content pre {
    @apply bg-surface-50 border-surface-200;
  }

  .light .analysis-content th {
    @apply text-surface-800 border-surface-300;
  }

  .light .analysis-content td {
    @apply text-surface-600 border-surface-200;
  }

  /* Figure explanation panel */
  .figure-explanation-panel {
    scrollbar-width: thin;
    scrollbar-color: rgba(100, 116, 139, 0.3) transparent;
  }

  .figure-explanation-panel::-webkit-scrollbar {
    width: 5px;
  }

  .figure-explanation-panel::-webkit-scrollbar-track {
    background: transparent;
  }

  .figure-explanation-panel::-webkit-scrollbar-thumb {
    @apply bg-surface-600/30 rounded-full;
  }

  .figure-explanation-panel::-webkit-scrollbar-thumb:hover {
    @apply bg-surface-500/50;
  }

  /* Figure explanation markdown overrides for dark modal context */
  .figure-explanation-content h2 {
    @apply text-base font-bold text-primary-300 mb-3 mt-6 first:mt-0 pb-1 border-b border-surface-700/50;
  }

  .figure-explanation-content h3 {
    @apply text-sm font-semibold text-surface-100 mb-2 mt-4;
  }

  .figure-explanation-content p {
    @apply text-[13px] text-surface-300 leading-[1.8] mb-3;
  }

  .figure-explanation-content ul {
    @apply list-disc list-outside ml-4 text-[13px] text-surface-300 mb-3 space-y-1.5;
  }

  .figure-explanation-content ol {
    @apply list-decimal list-outside ml-4 text-[13px] text-surface-300 mb-3 space-y-1.5;
  }

  .figure-explanation-content li {
    @apply leading-[1.7];
  }

  .figure-explanation-content strong {
    @apply text-surface-100 font-semibold;
  }

  .figure-explanation-content code {
    @apply text-xs bg-surface-700/80 text-primary-300 rounded px-1.5 py-0.5;
  }

  .figure-explanation-content blockquote {
    @apply border-l-2 border-primary-500/50 pl-3 italic text-surface-400 my-3 text-[13px];
  }

  .figure-explanation-content table {
    @apply w-full text-[13px] border-collapse my-4;
  }

  .figure-explanation-content th {
    @apply text-left font-semibold text-surface-200 border-b border-surface-600 pb-2 pr-4 text-xs;
  }

  .figure-explanation-content td {
    @apply text-surface-300 border-b border-surface-700/50 py-2 pr-4;
  }

  /* ── Figure modal: Light theme ── */

  .light .figure-modal {
    @apply bg-white border-surface-200 shadow-xl;
  }

  .light .figure-modal-header {
    @apply bg-white/95 border-surface-200;
  }

  .light .figure-modal-header h4 {
    @apply text-surface-800;
  }

  .light .figure-modal-header button {
    color: theme('colors.surface.500');
  }

  .light .figure-modal-header button:hover {
    color: theme('colors.surface.800');
    background-color: theme('colors.surface.100');
  }

  .light .figure-modal-header span {
    color: theme('colors.surface.500');
  }

  .light .figure-modal-image {
    @apply bg-surface-50;
  }

  .light .figure-modal-image p {
    @apply text-surface-600;
  }

  .light .figure-modal-divider {
    @apply bg-surface-200;
  }

  .light .figure-explanation-panel {
    scrollbar-color: rgba(148, 163, 184, 0.3) transparent;
  }

  .light .figure-explanation-panel::-webkit-scrollbar-thumb {
    @apply bg-surface-300/40 rounded-full;
  }

  .light .figure-explanation-panel::-webkit-scrollbar-thumb:hover {
    @apply bg-surface-400/50;
  }

  /* Light theme: explanation markdown */
  .light .figure-explanation-content h2 {
    @apply text-primary-700 border-surface-200;
  }

  .light .figure-explanation-content h3 {
    @apply text-surface-800;
  }

  .light .figure-explanation-content p {
    @apply text-surface-600;
  }

  .light .figure-explanation-content ul,
  .light .figure-explanation-content ol {
    @apply text-surface-600;
  }

  .light .figure-explanation-content li {
    @apply text-surface-600;
  }

  .light .figure-explanation-content strong {
    @apply text-surface-800;
  }

  .light .figure-explanation-content code {
    @apply bg-surface-100 text-primary-700;
  }

  .light .figure-explanation-content blockquote {
    @apply border-primary-400 text-surface-500;
  }

  .light .figure-explanation-content th {
    @apply text-surface-700 border-surface-300;
  }

  .light .figure-explanation-content td {
    @apply text-surface-600 border-surface-200;
  }

  /* Light theme: inner elements */
  .light .figure-modal .animate-pulse div {
    @apply bg-surface-200;
  }

  .light .figure-modal .border-b.border-surface-700\/50 {
    border-color: theme('colors.surface.200');
  }

/* ── App Layout: Light theme ── */

.light .flex.h-screen {
  background-color: #ffffff;
  color: theme('colors.surface.800');
}

/* Sidebar light theme */
.light aside {
  background-color: theme('colors.surface.50');
  border-color: theme('colors.surface.200');
}

.light aside .border-b {
  border-color: theme('colors.surface.200');
}

.light aside .border-t {
  border-color: theme('colors.surface.200');
}

.light aside h1 {
  color: theme('colors.surface.900');
}

.light aside p {
  color: theme('colors.surface.500');
}

.light aside nav a {
  color: theme('colors.surface.600');
}

.light aside nav a:hover {
  background-color: theme('colors.surface.100');
  color: theme('colors.surface.800');
}

.light aside nav a.active {
  background-color: theme('colors.primary.50');
  color: theme('colors.primary.700');
  border-color: theme('colors.primary.200');
}

.light aside nav > div {
  background-color: theme('colors.primary.50');
  color: theme('colors.primary.700');
  border-color: theme('colors.primary.200');
}

.light aside button {
  color: theme('colors.surface.500');
}

.light aside button:hover {
  color: theme('colors.surface.700');
  background-color: theme('colors.surface.100');
}

/* ── Workbench: Light theme ── */

.light main {
  background-color: #ffffff;
}

/* Workbench header bar */
.light .bg-surface-800.border-b {
  background-color: theme('colors.surface.50');
  border-color: theme('colors.surface.200');
}

/* Pages & panels background overrides */
.light [class*="bg-surface-900"] {
  background-color: #ffffff;
}

.light [class*="bg-surface-950"] {
  background-color: theme('colors.surface.50');
}

.light [class*="bg-surface-800"]:not(aside):not(pre):not(code) {
  background-color: theme('colors.surface.50');
}

/* Text color inversions for light mode */
.light [class*="text-surface-100"] {
  color: theme('colors.surface.900');
}

.light [class*="text-surface-200"]:not(a):not(button) {
  color: theme('colors.surface.700');
}

.light [class*="text-surface-300"]:not(a):not(button) {
  color: theme('colors.surface.600');
}

.light [class*="text-surface-400"]:not(a):not(button) {
  color: theme('colors.surface.500');
}

/* Border color inversions */
.light [class*="border-surface-700"] {
  border-color: theme('colors.surface.200');
}

.light [class*="border-surface-600"] {
  border-color: theme('colors.surface.300');
}

/* Hover overrides */
.light [class*="hover:bg-surface-700"]:hover {
  background-color: theme('colors.surface.100');
}

.light [class*="hover:text-surface-200"]:hover,
.light [class*="hover:text-surface-300"]:hover {
  color: theme('colors.surface.800');
}

/* ── Upload page: Light theme ── */

.light .border-dashed {
  border-color: theme('colors.surface.300');
}

.light .border-dashed:hover {
  border-color: theme('colors.primary.400');
}

/* ── ProgressTracker / RecipeCard: Light theme ── */

.light .phase-dot-pending {
  border-color: theme('colors.surface.300');
}

/* ── Skeleton loader: Light theme ── */

.light .animate-pulse [class*="bg-surface-700"] {
  background-color: theme('colors.surface.200');
}
